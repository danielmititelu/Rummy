@page "/rooms"
@using Rummy.Client.Services
@inject ChatService ChatService
@inject Microsoft.AspNetCore.Blazor.Services.IUriHelper UriHelper

<div class="row">
    <div class="col-sm">
        <label>Rooms</label>
    </div>
</div>
<div class="row">
    <div class="col-sm">
        <select bind="@selectedRoom" class="rooms-select" size="10">
            @foreach (var room in rooms)
            {
                <option value="@room">@room</option>
            }
        </select>
    </div>
</div>
<div class="row">
    <button class="btn btn-primary" type="button" onclick="@JoinRoom">Join Room</button>
</div>
<div class="row">
    <button class="btn btn-primary" type="button" onclick="@BackToHome">Back</button>
</div>
<div class="row">
    <p class="text-danger">@errorMessage</p>
</div>

@functions{
    List<string> rooms = new List<string>();
    string selectedRoom;
    string errorMessage;

    protected override async Task OnInitAsync()
    {
        rooms = await ChatService.GetRooms();
        StateHasChanged();
    }

    void JoinRoom()
    {
        if (selectedRoom == null)
        {
            errorMessage = "Please select a room";
            return;
        }
        UriHelper.NavigateTo($"chatRoom/{selectedRoom}");
    }

    void BackToHome()
    {
        UriHelper.NavigateTo("/");
    }
}
