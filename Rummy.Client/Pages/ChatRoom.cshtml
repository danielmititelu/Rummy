@page "/chatRoom/{RoomName}"
@using Rummy.Client.Services
@inject ChatService ChatService

<p>@RoomName</p>
<div class="container">
    <input type="text" id="message" class="form-control" bind="@message" />
    <input type="button" id="sendMessage" value="Send" class="btn btn-primary" onclick="@SendMessage" />
    <ul id="discussion">
        @foreach (var message in messages)
        {
            <li>@message</li>
        }
    </ul>
</div>


@functions{
    [Parameter]
    private string RoomName { get; set; }

    string message = "";
    IList<string> messages = new List<string>();

    protected override async Task OnInitAsync()
    {
        ChatService.OnBroadcastMessage(this.OnBroadcastMessage);
        await ChatService.JoinRoom(RoomName); 
    }

    Task OnBroadcastMessage(string name, string message)
    {
        messages.Add(name + " : " + message);
        StateHasChanged();
        return Task.CompletedTask;
    }

    async Task SendMessage()
    {
        await ChatService.SendMessage(message);
        message = "";
    }
}
